<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finanzas Black Premium</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#0b0c10;
  --card:#121317;
  --blue:#4a8cff;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --radius:18px;
  --shadow:0 0 20px rgba(74,140,255,.2);
  font-family:"Inter",-apple-system,system-ui,sans-serif;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  min-height:100vh;
}
.container{
  width:100%;
  max-width:420px;
  padding-bottom:90px;
}
h1,h2,h3{margin:0;color:var(--blue);}
.card{
  background:var(--card);
  margin:15px 20px;
  padding:18px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
.stat{
  display:flex;
  justify-content:space-between;
  margin:6px 0;
}
.btn{
  width:100%;
  background:var(--blue);
  border:none;
  padding:14px;
  border-radius:12px;
  color:white;
  font-weight:600;
  margin-top:10px;
  cursor:pointer;
}
.btn:active{transform:scale(.98);}
input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-top:6px;
  background:#1a1b1f;
  color:white;
}
label{color:var(--muted);font-size:.9rem;}
.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#0d0e12;
  border-top:1px solid #1e1f24;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
  z-index:10;
}
.bottom-nav button{
  background:none;
  border:none;
  color:var(--muted);
  font-size:.8rem;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.bottom-nav button.active{color:var(--blue);}
.icon{font-size:1.4rem;}
.section{display:none;}
.section.active{display:block;}
.chart-container{position:relative;height:200px;width:100%;}
.list-item{border-bottom:1px solid #1f2025;padding:10px 0;}
.gold{color:var(--blue);}
</style>
</head>
<body>
<div class="container">
  <section id="home" class="section active">
    <div class="card">
      <h2>Resumen General</h2>
      <canvas id="grafico"></canvas>
      <div class="stat"><span>Saldo Actual</span><strong id="saldo">$0.00</strong></div>
      <div class="stat"><span>Ingresos del Mes</span><strong id="ingresosMes">$0.00</strong></div>
      <div class="stat"><span>Gastos del Mes</span><strong id="gastosMes">$0.00</strong></div>
    </div>
    <div class="card">
      <h2>Deudas Activas</h2>
      <div id="listaDeudas"></div>
    </div>
  </section>

  <section id="ingresos" class="section">
    <div class="card">
      <h2>Registrar Ingreso</h2>
      <label>Monto</label><input type="number" id="montoIngreso">
      <label>Descripci√≥n</label><input type="text" id="descIngreso">
      <button class="btn" onclick="agregarIngreso()">Guardar</button>
    </div>
    <div class="card">
      <h2>Historial</h2>
      <div id="historialIngresos"></div>
    </div>
  </section>

  <section id="gastos" class="section">
    <div class="card">
      <h2>Registrar Gasto</h2>
      <label>Monto</label><input type="number" id="montoGasto">
      <label>Descripci√≥n</label><input type="text" id="descGasto">
      <button class="btn" onclick="agregarGasto()">Guardar</button>
    </div>
    <div class="card">
      <h2>Historial</h2>
      <div id="historialGastos"></div>
    </div>
  </section>

  <section id="deudas" class="section">
    <div class="card">
      <h2>Agregar Deuda</h2>
      <label>Nombre</label><input id="nombreDeuda">
      <label>Monto Total</label><input id="montoDeuda" type="number">
      <label>Meses</label><input id="mesesDeuda" type="number">
      <button class="btn" onclick="agregarDeuda()">Guardar</button>
    </div>
    <div class="card">
      <h2>Deudas</h2>
      <div id="listaDeudasDet"></div>
    </div>
  </section>

  <section id="config" class="section">
    <div class="card">
      <h2>Configuraci√≥n</h2>
      <label>Salario Mensual</label>
      <input id="salario" type="number">
      <button class="btn" onclick="guardarSalario()">Guardar</button>
      <button class="btn" style="background:#1a1b1f;margin-top:10px" onclick="resetDatos()">Resetear</button>
    </div>
  </section>
</div>

<div class="bottom-nav">
  <button class="active" onclick="show('home',this)"><span class="icon">üè†</span>Inicio</button>
  <button onclick="show('ingresos',this)"><span class="icon">üíµ</span>Ingresos</button>
  <button onclick="show('gastos',this)"><span class="icon">üí∏</span>Gastos</button>
  <button onclick="show('deudas',this)"><span class="icon">üí≥</span>Deudas</button>
  <button onclick="show('config',this)"><span class="icon">‚öôÔ∏è</span>Config</button>
</div>

<script>
function show(id,btn){
 document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 document.querySelectorAll('.bottom-nav button').forEach(b=>b.classList.remove('active'));
 btn.classList.add('active');
}
/* ============================================================
   BLOQUE 2/3 ‚Äî DASHBOARD + GRAFICA + INGRESOS/GASTOS
   ============================================================ */

let ingresos = JSON.parse(localStorage.getItem("ingresos")) || [];
let gastos = JSON.parse(localStorage.getItem("gastos")) || [];
let deudas = JSON.parse(localStorage.getItem("deudas")) || [];
let salarioMensual = JSON.parse(localStorage.getItem("salarioMensual")) || 0;

// ---------- Chart.js setup ----------
let ctx = document.getElementById('grafico').getContext('2d');
let grafico = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['Ingresos', 'Gastos'],
    datasets: [{
      label: 'Resumen',
      data: [0, 0],
      backgroundColor: ['#4a8cff', '#1e293b']
    }]
  },
  options: {
    plugins: { legend: { display: false } },
    scales: {
      y: { beginAtZero: true, ticks: { color: '#9ca3af' }, grid: { color: '#1e1f24' } },
      x: { ticks: { color: '#9ca3af' }, grid: { color: '#1e1f24' } }
    }
  }
});

// ============================================================
// FUNCIONES DE INGRESOS
// ============================================================
function agregarIngreso(){
  const monto = parseFloat(document.getElementById("montoIngreso").value);
  const desc = document.getElementById("descIngreso").value.trim();
  if(!monto || monto <= 0 || !desc){alert("Datos inv√°lidos");return;}
  ingresos.push({id:Date.now(),monto,desc,fecha:new Date().toISOString().split("T")[0]});
  localStorage.setItem("ingresos",JSON.stringify(ingresos));
  document.getElementById("montoIngreso").value="";
  document.getElementById("descIngreso").value="";
  renderIngresos(); actualizarDashboard();
}

function renderIngresos(){
  const div=document.getElementById("historialIngresos");
  div.innerHTML="";
  ingresos.slice().reverse().forEach(i=>{
    const d=document.createElement("div");
    d.className="list-item";
    d.innerHTML=`${i.fecha} ‚Äî <strong>$${i.monto.toFixed(2)}</strong> ${i.desc}`;
    div.appendChild(d);
  });
}

// ============================================================
// FUNCIONES DE GASTOS
// ============================================================
function agregarGasto(){
  const monto = parseFloat(document.getElementById("montoGasto").value);
  const desc = document.getElementById("descGasto").value.trim();
  if(!monto || monto <= 0 || !desc){alert("Datos inv√°lidos");return;}
  gastos.push({id:Date.now(),monto,desc,fecha:new Date().toISOString().split("T")[0]});
  localStorage.setItem("gastos",JSON.stringify(gastos));
  document.getElementById("montoGasto").value="";
  document.getElementById("descGasto").value="";
  renderGastos(); actualizarDashboard();
}

function renderGastos(){
  const div=document.getElementById("historialGastos");
  div.innerHTML="";
  gastos.slice().reverse().forEach(g=>{
    const d=document.createElement("div");
    d.className="list-item";
    d.innerHTML=`${g.fecha} ‚Äî <strong>$${g.monto.toFixed(2)}</strong> ${g.desc}`;
    div.appendChild(d);
  });
}

// ============================================================
// DASHBOARD GENERAL
// ============================================================
function actualizarDashboard(){
  const totalIngresos = ingresos.reduce((s,i)=>s+i.monto,0);
  const totalGastos = gastos.reduce((s,g)=>s+g.monto,0);
  const saldo = totalIngresos - totalGastos;
  document.getElementById("saldo").innerText = `$${saldo.toFixed(2)}`;
  document.getElementById("ingresosMes").innerText = `$${totalIngresos.toFixed(2)}`;
  document.getElementById("gastosMes").innerText = `$${totalGastos.toFixed(2)}`;
  grafico.data.datasets[0].data = [totalIngresos, totalGastos];
  grafico.update();
  renderDeudasHome();
}

// ============================================================
// RENDER DEUDAS EN HOME
// ============================================================
function renderDeudasHome(){
  const cont = document.getElementById("listaDeudas");
  cont.innerHTML="";
  if(deudas.length===0){cont.innerHTML="<div class='list-item'>No hay deudas activas</div>";return;}
  deudas.forEach(d=>{
    const pagadas = mesesPagados(d);
    const saldo = saldoPendiente(d);
    const restante = d.meses - pagadas;
    const div=document.createElement("div");
    div.className="list-item";
    div.innerHTML=`
      <div><strong>${d.nombre}</strong> ‚Äî ${pagadas}/${d.meses} pagadas</div>
      <div style="color:#4a8cff;">Pendiente: $${saldo.toFixed(2)}</div>
      <div style="font-size:.8rem;color:#9ca3af;">${restante} meses restantes</div>`;
    cont.appendChild(div);
  });
}

// ============================================================
// INICIALIZAR
// ============================================================
renderIngresos();
renderGastos();
actualizarDashboard();
/* ============================================================
   BLOQUE 3/3 ‚Äî DEUDAS + ABONOS + SALARIO + RESET + CIERRE
   ============================================================ */

// ---------- Funciones de Deudas ----------
function agregarDeuda(){
  const nombre = document.getElementById("nombreDeuda").value.trim();
  const monto = parseFloat(document.getElementById("montoDeuda").value);
  const meses = parseInt(document.getElementById("mesesDeuda").value);
  if(!nombre || !monto || monto<=0 || !meses || meses<=0){alert("Datos inv√°lidos");return;}
  const cuota = monto/meses;
  deudas.push({
    id:Date.now(),
    nombre,monto,meses,cuota,
    fecha:new Date().toISOString().split("T")[0],
    abonos:[]
  });
  localStorage.setItem("deudas",JSON.stringify(deudas));
  document.getElementById("nombreDeuda").value="";
  document.getElementById("montoDeuda").value="";
  document.getElementById("mesesDeuda").value="";
  renderDeudasDet(); actualizarDashboard();
}

function mesesPagados(d){
  const fechaInicio = new Date(d.fecha);
  const hoy = new Date();
  let diff = (hoy.getFullYear()-fechaInicio.getFullYear())*12 + (hoy.getMonth()-fechaInicio.getMonth());
  if(diff<0) diff=0;
  if(diff>d.meses) diff=d.meses;
  return diff;
}

function saldoPendiente(d){
  const pag = mesesPagados(d);
  const pagado = pag*d.cuota;
  const abonos = d.abonos.reduce((s,a)=>s+a.monto,0);
  return Math.max(d.monto - pagado - abonos,0);
}

function registrarAbono(id){
  const monto = parseFloat(prompt("Monto del abono:"));
  if(!monto || monto<=0){alert("Monto inv√°lido");return;}
  const deuda = deudas.find(x=>x.id===id);
  deuda.abonos.push({monto,fecha:new Date().toISOString().split("T")[0]});
  localStorage.setItem("deudas",JSON.stringify(deudas));
  renderDeudasDet(); actualizarDashboard();
}

function renderDeudasDet(){
  const cont = document.getElementById("listaDeudasDet");
  cont.innerHTML="";
  if(deudas.length===0){cont.innerHTML="<div class='list-item'>Sin deudas</div>";return;}
  deudas.forEach(d=>{
    const pag = mesesPagados(d);
    const saldo = saldoPendiente(d);
    const restante = d.meses - pag;
    const div=document.createElement("div");
    div.className="list-item";
    let hist="";
    d.abonos.slice().reverse().forEach(a=>{
      hist += `<div style='font-size:.8rem;color:#9ca3af;'>${a.fecha} ‚Üí $${a.monto.toFixed(2)}</div>`;
    });
    div.innerHTML=`
      <div><strong>${d.nombre}</strong> ‚Äî ${pag}/${d.meses} pagadas</div>
      <div style="color:#4a8cff;">Saldo: $${saldo.toFixed(2)}</div>
      <div style="font-size:.8rem;color:#9ca3af;">${restante} meses restantes</div>
      <button class='btn' style='margin-top:8px;' onclick='registrarAbono(${d.id})'>Abonar</button>
      ${hist?`<div style='margin-top:6px;'>${hist}</div>`:""}
    `;
    cont.appendChild(div);
  });
}

// ---------- Fecha de pago (d√≠a 16 o 15 si domingo) ----------
function proximoPago(){
  const hoy = new Date();
  let pago = new Date(hoy.getFullYear(),hoy.getMonth(),16);
  if(pago.getDay()===0) pago.setDate(15);
  return pago.toISOString().split("T")[0];
}

// ---------- Salario ----------
function guardarSalario(){
  const val=parseFloat(document.getElementById("salario").value);
  if(!val||val<=0){alert("Salario inv√°lido");return;}
  salarioMensual=val;
  localStorage.setItem("salarioMensual",JSON.stringify(salarioMensual));
  alert("Salario guardado.");
}

// ---------- Reset ----------
function resetDatos(){
  if(!confirm("¬øEliminar todos los datos?"))return;
  ingresos=[];gastos=[];deudas=[];salarioMensual=0;
  localStorage.clear();
  renderIngresos();renderGastos();renderDeudasDet();actualizarDashboard();
  alert("Sistema reiniciado.");
}

// ---------- Inicializaci√≥n ----------
document.addEventListener("DOMContentLoaded",()=>{
  renderDeudasDet();
  actualizarDashboard();
});
</script>
</body>
</html>
