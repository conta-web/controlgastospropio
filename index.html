<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Financiero Personal</title>

<style>
/* ================================================================
   ESTILO APP TIPO APPLE
================================================================ */
:root {
    --bg: #f5f5f7;
    --white: #ffffff;
    --gray: #e5e5ea;
    --black: #1c1c1e;
    --text: #111111;
    --blue: #007aff;
    --danger: #ff3b30;
    --success: #34c759;
    --card-radius: 16px;
    --shadow: 0 4px 10px rgba(0,0,0,.06);
    --sidebar-width: 260px;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
}

body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    display: flex;
}

/* ================================================================
   SIDEBAR
================================================================ */
.sidebar {
    width: var(--sidebar-width);
    background: var(--white);
    height: 100vh;
    border-right: 1px solid var(--gray);
    padding: 20px 15px;
    box-sizing: border-box;
    position: fixed;
}

.logo {
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 30px;
    color: var(--black);
}

.menu {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.menu button {
    background: transparent;
    border: none;
    padding: 12px 14px;
    font-size: 1rem;
    text-align: left;
    border-radius: 12px;
    cursor: pointer;
    transition: .2s;
}

.menu button:hover {
    background: var(--gray);
}

.menu button.active {
    background: var(--blue);
    color: white;
}

/* ================================================================
   MAIN CONTENT
================================================================ */
.main {
    margin-left: var(--sidebar-width);
    padding: 20px;
    width: calc(100% - var(--sidebar-width));
    box-sizing: border-box;
}

.section {
    display: none;
}

.section.active {
    display: block;
}

/* ================================================================
   CARDS
================================================================ */
.card {
    background: var(--white);
    padding: 20px;
    border-radius: var(--card-radius);
    box-shadow: var(--shadow);
    margin-bottom: 20px;
}

.card h2 {
    margin-top: 0;
    font-size: 1.4rem;
    margin-bottom: 10px;
}

/* ================================================================
   FORM INPUTS
================================================================ */
.input-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 12px;
}

.input-group label {
    font-weight: 600;
    margin-bottom: 5px;
}

.input-group input, .input-group select {
    padding: 10px;
    border: 1px solid var(--gray);
    border-radius: 10px;
    background: #fafafa;
}

/* BOTONES */
.btn {
    padding: 12px 16px;
    background: var(--blue);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: .9rem;
    font-weight: 600;
    cursor: pointer;
    transition: .2s;
}

.btn:hover { opacity: .8; }

/* TABLAS */
.table {
    width: 100%;
    border-collapse: collapse;
}

.table th, .table td {
    padding: 12px;
    border-bottom: 1px solid var(--gray);
    text-align: left;
}

.table th {
    font-weight: 700;
}
</style>
</head>
<body>

<!-- ================================================================
   SIDEBAR
================================================================ -->
<div class="sidebar">
    <div class="logo">üí∞ Finanzas Personales</div>

    <div class="menu">
        <button class="active" onclick="showSection('dashboard')">Dashboard</button>
        <button onclick="showSection('ingresos')">Ingresos</button>
        <button onclick="showSection('gastos')">Gastos</button>
        <button onclick="showSection('tarjetas')">Tarjetas de Cr√©dito</button>
        <button onclick="showSection('proyecciones')">Proyecciones</button>
        <button onclick="showSection('config')">Configuraci√≥n</button>
    </div>
</div>

<!-- ================================================================
   MAIN CONTENT
================================================================ -->
<div class="main">

    <!-- =================== DASHBOARD =================== -->
    <section id="dashboard" class="section active">
        <h1>Dashboard General</h1>

        <div class="card">
            <h2>Resumen del mes</h2>
            <p><strong>Saldo actual:</strong> $<span id="saldoActual">0.00</span></p>
            <p><strong>Total de gastos:</strong> $<span id="totalGastosMes">0.00</span></p>
            <p><strong>Pendiente total en tarjetas:</strong> $<span id="pendienteTarjetas">0.00</span></p>
        </div>

        <div class="card">
            <h2>Pr√≥ximos pagos</h2>
            <ul id="listaProximosPagos"></ul>
        </div>
    </section>

    <!-- =================== INGRESOS =================== -->
    <section id="ingresos" class="section">
        <h1>Ingresos</h1>

        <div class="card">
            <h2>Registrar ingreso</h2>

            <div class="input-group">
                <label>Monto</label>
                <input type="number" id="ingresoMonto">
            </div>

            <div class="input-group">
                <label>Descripci√≥n</label>
                <input type="text" id="ingresoDesc">
            </div>

            <button class="btn" onclick="agregarIngreso()">Guardar ingreso</button>
        </div>

        <div class="card">
            <h2>Historial de ingresos</h2>
            <table class="table" id="tablaIngresos"></table>
        </div>
    </section>

    <!-- =================== GASTOS =================== -->
    <section id="gastos" class="section">
        <h1>Gastos</h1>

        <div class="card">
            <h2>Registrar gasto</h2>

            <div class="input-group">
                <label>Monto</label>
                <input type="number" id="gastoMonto">
            </div>

            <div class="input-group">
                <label>Descripci√≥n</label>
                <input type="text" id="gastoDesc">
            </div>

            <button class="btn" onclick="agregarGasto()">Guardar gasto</button>
        </div>

        <div class="card">
            <h2>Historial de gastos</h2>
            <table class="table" id="tablaGastos"></table>
        </div>
    </section>

    <!-- =================== TARJETAS =================== -->
    <section id="tarjetas" class="section">
        <h1>Tarjetas de Cr√©dito</h1>

        <div class="card">
            <h2>Agregar tarjeta</h2>

            <div class="input-group">
                <label>Nombre</label>
                <input type="text" id="tarjetaNombre">
            </div>

            <div class="input-group">
                <label>Banco</label>
                <input type="text" id="tarjetaBanco">
            </div>

            <div class="input-group">
                <label>Fecha de compra</label>
                <input type="date" id="tarjetaFecha">
            </div>

            <div class="input-group">
                <label>Monto total</label>
                <input type="number" id="tarjetaMonto">
            </div>

            <div class="input-group">
                <label>N√∫mero de cuotas</label>
                <input type="number" id="tarjetaCuotas">
            </div>

            <button class="btn" onclick="agregarTarjeta()">Agregar tarjeta</button>
        </div>

        <div class="card">
            <h2>Listado de tarjetas</h2>
            <table class="table" id="tablaTarjetas"></table>
        </div>
    </section>

    <!-- =================== PROYECCIONES =================== -->
    <section id="proyecciones" class="section">
        <h1>Proyecciones & Ahorro</h1>

        <div class="card">
            <h2>Ahorro recomendado por quincena</h2>
            <p>Total recomendado: <strong>$<span id="ahorroQuincena">0.00</span></strong></p>
        </div>

        <div class="card">
            <h2>Detalle de pagos</h2>
            <ul id="detallePagosFuturos"></ul>
        </div>
    </section>

    <!-- =================== CONFIG =================== -->
    <section id="config" class="section">
        <h1>Configuraci√≥n</h1>

        <div class="card">
            <h2>Mi salario</h2>

            <div class="input-group">
                <label>Salario mensual</label>
                <input type="number" id="salarioMonto">
            </div>

            <button class="btn" onclick="guardarSalario()">Guardar</button>
        </div>

        <div class="card">
            <h2>Resetear sistema</h2>
            <button class="btn" style="background: var(--danger)" onclick="resetDatos()">Restablecer datos</button>
        </div>

    </section>
</div>

<!-- ================================================================
   SCRIPT ‚Äî BLOQUE 2 VIENE LUEGO
================================================================ -->
<script>
function showSection(sec) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(sec).classList.add('active');

    document.querySelectorAll('.menu button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
}
</script>
<script>
// ================================================================
//  SISTEMA FINANCIERO ‚Äî BLOQUE 2/3
// ================================================================

// =====================
// VARIABLES GLOBALES
// =====================
let ingresos = JSON.parse(localStorage.getItem("ingresos")) || [];
let gastos = JSON.parse(localStorage.getItem("gastos")) || [];
let tarjetas = JSON.parse(localStorage.getItem("tarjetas")) || [];
let salarioMensual = JSON.parse(localStorage.getItem("salarioMensual")) || 0;

// =====================
// GUARDAR EN LOCALSTORAGE
// =====================
function guardarData() {
    localStorage.setItem("ingresos", JSON.stringify(ingresos));
    localStorage.setItem("gastos", JSON.stringify(gastos));
    localStorage.setItem("tarjetas", JSON.stringify(tarjetas));
    localStorage.setItem("salarioMensual", JSON.stringify(salarioMensual));
}

// ================================================================
//  INGRESOS
// ================================================================
function agregarIngreso() {
    const monto = parseFloat(document.getElementById("ingresoMonto").value);
    const desc = document.getElementById("ingresoDesc").value;

    if (!monto || monto <= 0) return alert("Monto inv√°lido");
    if (!desc) return alert("Ingrese descripci√≥n");

    ingresos.push({
        id: Date.now(),
        monto,
        desc,
        fecha: new Date().toISOString().split('T')[0]
    });

    guardarData();
    renderIngresos();
    calcularDashboard();

    document.getElementById("ingresoMonto").value = "";
    document.getElementById("ingresoDesc").value = "";
}

function renderIngresos() {
    const tabla = document.getElementById("tablaIngresos");
    tabla.innerHTML = `
        <tr>
            <th>Monto</th>
            <th>Descripci√≥n</th>
            <th>Fecha</th>
            <th></th>
        </tr>
    `;

    ingresos.forEach(i => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>$${i.monto.toFixed(2)}</td>
            <td>${i.desc}</td>
            <td>${i.fecha}</td>
            <td><button onclick="eliminarIngreso(${i.id})" style="background:#ff3b30;color:white;border:none;padding:5px 10px;border-radius:6px;">X</button></td>
        `;
        tabla.appendChild(tr);
    });
}

function eliminarIngreso(id) {
    ingresos = ingresos.filter(i => i.id !== id);
    guardarData();
    renderIngresos();
    calcularDashboard();
}

// ================================================================
//  GASTOS
// ================================================================
function agregarGasto() {
    const monto = parseFloat(document.getElementById("gastoMonto").value);
    const desc = document.getElementById("gastoDesc").value;

    if (!monto || monto <= 0) return alert("Monto inv√°lido");
    if (!desc) return alert("Ingrese descripci√≥n");

    gastos.push({
        id: Date.now(),
        monto,
        desc,
        fecha: new Date().toISOString().split('T')[0]
    });

    guardarData();
    renderGastos();
    calcularDashboard();

    document.getElementById("gastoMonto").value = "";
    document.getElementById("gastoDesc").value = "";
}

function renderGastos() {
    const tabla = document.getElementById("tablaGastos");
    tabla.innerHTML = `
        <tr>
            <th>Monto</th>
            <th>Descripci√≥n</th>
            <th>Fecha</th>
            <th></th>
        </tr>
    `;

    gastos.forEach(g => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>$${g.monto.toFixed(2)}</td>
            <td>${g.desc}</td>
            <td>${g.fecha}</td>
            <td><button onclick="eliminarGasto(${g.id})" style="background:#ff3b30;color:white;border:none;padding:5px 10px;border-radius:6px;">X</button></td>
        `;
        tabla.appendChild(tr);
    });
}

function eliminarGasto(id) {
    gastos = gastos.filter(g => g.id !== id);
    guardarData();
    renderGastos();
    calcularDashboard();
}

// ================================================================
//  SALARIO MENSUAL ‚Äî QUINCENA AUTOM√ÅTICA
// ================================================================
function guardarSalario() {
    const val = parseFloat(document.getElementById("salarioMonto").value);
    if (!val || val <= 0) return alert("Salario inv√°lido");

    salarioMensual = val;
    guardarData();
    alert("Salario guardado");
}

function obtenerFechasDePago() {
    const hoy = new Date();
    const year = hoy.getFullYear();
    const month = hoy.getMonth() + 1;

    let fechas = [];

    function ajustarDomingo(date) {
        if (date.getDay() === 0) date.setDate(date.getDate() - 1);
        return date;
    }

    // pago 1 ‚Üí d√≠a 15
    let pago1 = new Date(`${year}-${month}-15`);
    pago1 = ajustarDomingo(pago1);

    // pago 2 ‚Üí √∫ltimo d√≠a del mes
    let ultimoDia = new Date(year, month, 0);
    ultimoDia = ajustarDomingo(ultimoDia);

    fechas.push({
        fecha: pago1.toISOString().split('T')[0],
        monto: salarioMensual / 2
    });

    fechas.push({
        fecha: ultimoDia.toISOString().split('T')[0],
        monto: salarioMensual / 2
    });

    return fechas;
}

// ================================================================
//  DASHBOARD GENERAL
// ================================================================
function calcularDashboard() {
    // saldo total
    let totalIngresos = ingresos.reduce((sum, i) => sum + i.monto, 0);
    let totalGastos = gastos.reduce((sum, g) => sum + g.monto, 0);
    let saldo = totalIngresos - totalGastos;

    document.getElementById("saldoActual").innerText = saldo.toFixed(2);

    document.getElementById("totalGastosMes").innerText = totalGastos.toFixed(2);

    // tarjetas ‚Üí se calcular√° en Bloque 3
}

// ================================================================
//  RESETAR SISTEMA
// ================================================================
function resetDatos() {
    if (!confirm("¬øSeguro que deseas eliminar TODOS los datos?")) return;

    ingresos = [];
    gastos = [];
    tarjetas = [];
    salarioMensual = 0;

    guardarData();

    renderIngresos();
    renderGastos();
    renderTarjetas();
    calcularDashboard();

    alert("Sistema restaurado.");
}

// ================================================================
//  INICIALIZAR
// ================================================================
renderIngresos();
renderGastos();
calcularDashboard();
// ================================================================
//  TARJETAS DE CR√âDITO (Sistema completo)
// ================================================================
function agregarTarjeta() {
    const nombre = document.getElementById("tarjetaNombre").value;
    const banco = document.getElementById("tarjetaBanco").value;
    const fecha = document.getElementById("tarjetaFecha").value;
    const monto = parseFloat(document.getElementById("tarjetaMonto").value);
    const cuotas = parseInt(document.getElementById("tarjetaCuotas").value);

    if (!nombre || !banco || !fecha || !monto || monto <= 0 || !cuotas || cuotas <= 0)
        return alert("Completa todos los datos correctamente");

    const cuotaMensual = monto / cuotas;

    tarjetas.push({
        id: Date.now(),
        nombre,
        banco,
        fecha,
        monto,
        cuotas,
        cuotaMensual,
        fechaRegistro: new Date().toISOString().split("T")[0]
    });

    guardarData();
    renderTarjetas();
    calcularProyecciones();
    calcularDashboard();

    // limpiar inputs
    document.getElementById("tarjetaNombre").value = "";
    document.getElementById("tarjetaBanco").value = "";
    document.getElementById("tarjetaFecha").value = "";
    document.getElementById("tarjetaMonto").value = "";
    document.getElementById("tarjetaCuotas").value = "";
}

// ================================================================
//  Calcular cu√°ntas cuotas ya han sido pagadas
// ================================================================
function cuotasPagadas(tarjeta) {
    const fechaCompra = new Date(tarjeta.fecha);
    const hoy = new Date();

    let meses =
        (hoy.getFullYear() - fechaCompra.getFullYear()) * 12 +
        (hoy.getMonth() - fechaCompra.getMonth());

    if (meses < 0) meses = 0;
    if (meses > tarjeta.cuotas) meses = tarjeta.cuotas;

    return meses;
}

// ================================================================
//  RENDER TABLA DE TARJETAS
// ================================================================
function renderTarjetas() {
    const tabla = document.getElementById("tablaTarjetas");
    tabla.innerHTML = `
        <tr>
            <th>Tarjeta</th>
            <th>Banco</th>
            <th>Monto</th>
            <th>Cuotas</th>
            <th>Cuota Mensual</th>
            <th>Pagadas</th>
            <th>Pendientes</th>
            <th>Eliminar</th>
        </tr>
    `;

    tarjetas.forEach(t => {
        const pag = cuotasPagadas(t);
        const pen = t.cuotas - pag;

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${t.nombre}</td>
            <td>${t.banco}</td>
            <td>$${t.monto.toFixed(2)}</td>
            <td>${t.cuotas}</td>
            <td>$${t.cuotaMensual.toFixed(2)}</td>
            <td>${pag}</td>
            <td>${pen}</td>
            <td><button onclick="eliminarTarjeta(${t.id})" style="background:#ff3b30;color:white;border:none;padding:6px 10px;border-radius:6px;">X</button></td>
        `;
        tabla.appendChild(tr);
    });
}

function eliminarTarjeta(id) {
    tarjetas = tarjetas.filter(t => t.id !== id);
    guardarData();
    renderTarjetas();
    calcularProyecciones();
    calcularDashboard();
}

// ================================================================
//  TOTAL PENDIENTE EN TARJETAS
// ================================================================
function totalPendienteTarjetas() {
    let total = 0;
    tarjetas.forEach(t => {
        const pag = cuotasPagadas(t);
        const pendientes = t.cuotas - pag;
        total += pendientes * t.cuotaMensual;
    });
    return total;
}

// ================================================================
//  PR√ìXIMOS PAGOS
// ================================================================
function obtenerProximosPagos() {
    let lista = [];

    tarjetas.forEach(t => {
        const pagadas = cuotasPagadas(t);
        const pendientes = t.cuotas - pagadas;

        if (pendientes > 0) {
            // siguiente pago es el 15 o el 30
            const fechas = obtenerFechasDePago();

            lista.push({
                tarjeta: t.nombre,
                banco: t.banco,
                monto: t.cuotaMensual,
                fecha: fechas[0].fecha  // siguiente quincena
            });
        }
    });

    return lista;
}

function renderProximosPagos() {
    const ul = document.getElementById("listaProximosPagos");
    ul.innerHTML = "";

    const pagos = obtenerProximosPagos();

    pagos.forEach(p => {
        const li = document.createElement("li");
        li.innerHTML = `üìÖ ${p.fecha}: <strong>${p.tarjeta}</strong> (${p.banco}) ‚Üí $${p.monto.toFixed(2)}`;
        ul.appendChild(li);
    });
}

// ================================================================
//  PROYECCI√ìN ‚Äî AHORRO POR QUINCENA
// ================================================================
function calcularProyecciones() {
    let totalPendiente = totalPendienteTarjetas();

    const fechas = obtenerFechasDePago();
    // cada quincena aporta la mitad del salario
    const quincena = salarioMensual / 2;

    let recomendado = 0;

    if (tarjetas.length > 0) {
        // suma de todas las cuotas mensuales
        let totalCuotasMensuales = tarjetas.reduce((sum, t) => sum + t.cuotaMensual, 0);

        recomendado = totalCuotasMensuales / 2; // para no afectar una sola quincena
    }

    document.getElementById("ahorroQuincena").innerText = recomendado.toFixed(2);

    // lista detallada
    const detalle = document.getElementById("detallePagosFuturos");
    detalle.innerHTML = "";

    tarjetas.forEach(t => {
        const pag = cuotasPagadas(t);
        const pen = t.cuotas - pag;

        const li = document.createElement("li");
        li.innerHTML = `
            üîπ ${t.nombre} (${t.banco})
            ‚Äî ${pen} cuotas pendientes de $${t.cuotaMensual.toFixed(2)}
        `;
        detalle.appendChild(li);
    });
}

// ================================================================
//  DASHBOARD FINAL COMPLETO
// ================================================================
function calcularDashboard() {
    let totalIngresos = ingresos.reduce((s, i) => s + i.monto, 0);
    let totalGastos = gastos.reduce((s, g) => s + g.monto, 0);
    let saldo = totalIngresos - totalGastos;

    document.getElementById("saldoActual").innerText = saldo.toFixed(2);
    document.getElementById("totalGastosMes").innerText = totalGastos.toFixed(2);

    document.getElementById("pendienteTarjetas").innerText = totalPendienteTarjetas().toFixed(2);

    renderProximosPagos();
}

// ================================================================
//  INICIALIZACI√ìN FINAL
// ================================================================
renderTarjetas();
calcularProyecciones();
calcularDashboard();

</script>
</html>
